<?xml version="1.0" encoding="UTF-8"?>
<svg width="600" height="450" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#666"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="600" height="450" fill="#FAFAFA"/>

  <!-- Title -->
  <text x="300" y="25" font-family="Arial" font-size="16" font-weight="bold" text-anchor="middle" fill="#333">Firestore Database Schema</text>

  <!-- Users Collection -->
  <rect x="30" y="50" width="170" height="130" rx="8" fill="#E3F2FD" stroke="#2196F3" stroke-width="2"/>
  <rect x="30" y="50" width="170" height="30" rx="8" fill="#2196F3"/>
  <text x="115" y="70" font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle" fill="white">users/{userId}</text>

  <text x="40" y="100" font-family="Arial" font-size="10" fill="#333">displayName: string</text>
  <text x="40" y="115" font-family="Arial" font-size="10" fill="#333">email: string</text>
  <text x="40" y="130" font-family="Arial" font-size="10" fill="#333">college: string</text>
  <text x="40" y="145" font-family="Arial" font-size="10" fill="#333">minimumAttendance: number</text>
  <text x="40" y="160" font-family="Arial" font-size="10" fill="#333">onboardingCompleted: bool</text>

  <!-- User Subcollections -->
  <rect x="30" y="200" width="80" height="35" rx="5" fill="#C8E6C9" stroke="#4CAF50" stroke-width="1.5"/>
  <text x="70" y="222" font-family="Arial" font-size="9" text-anchor="middle" fill="#333">timetable</text>

  <rect x="120" y="200" width="80" height="35" rx="5" fill="#C8E6C9" stroke="#4CAF50" stroke-width="1.5"/>
  <text x="160" y="222" font-family="Arial" font-size="9" text-anchor="middle" fill="#333">subjects</text>

  <rect x="75" y="250" width="80" height="35" rx="5" fill="#C8E6C9" stroke="#4CAF50" stroke-width="1.5"/>
  <text x="115" y="272" font-family="Arial" font-size="9" text-anchor="middle" fill="#333">attendance</text>

  <!-- Lines from users to subcollections -->
  <line x1="70" y1="180" x2="70" y2="200" stroke="#4CAF50" stroke-width="1.5"/>
  <line x1="160" y1="180" x2="160" y2="200" stroke="#4CAF50" stroke-width="1.5"/>
  <line x1="115" y1="180" x2="115" y2="250" stroke="#4CAF50" stroke-width="1.5"/>

  <!-- Notes Collection -->
  <rect x="230" y="50" width="160" height="120" rx="8" fill="#FFF3E0" stroke="#FF9800" stroke-width="2"/>
  <rect x="230" y="50" width="160" height="30" rx="8" fill="#FF9800"/>
  <text x="310" y="70" font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle" fill="white">notes/{noteId}</text>

  <text x="240" y="100" font-family="Arial" font-size="10" fill="#333">title: string</text>
  <text x="240" y="115" font-family="Arial" font-size="10" fill="#333">content: string</text>
  <text x="240" y="130" font-family="Arial" font-size="10" fill="#333">authorId: string</text>
  <text x="240" y="145" font-family="Arial" font-size="10" fill="#333">likesCount: number</text>

  <!-- Notes Subcollections -->
  <rect x="230" y="200" width="70" height="35" rx="5" fill="#FFECB3" stroke="#FFC107" stroke-width="1.5"/>
  <text x="265" y="222" font-family="Arial" font-size="9" text-anchor="middle" fill="#333">likes</text>

  <rect x="310" y="200" width="80" height="35" rx="5" fill="#FFECB3" stroke="#FFC107" stroke-width="1.5"/>
  <text x="350" y="222" font-family="Arial" font-size="9" text-anchor="middle" fill="#333">comments</text>

  <line x1="265" y1="170" x2="265" y2="200" stroke="#FFC107" stroke-width="1.5"/>
  <line x1="350" y1="170" x2="350" y2="200" stroke="#FFC107" stroke-width="1.5"/>

  <!-- Groups Collection -->
  <rect x="420" y="50" width="160" height="120" rx="8" fill="#F3E5F5" stroke="#9C27B0" stroke-width="2"/>
  <rect x="420" y="50" width="160" height="30" rx="8" fill="#9C27B0"/>
  <text x="500" y="70" font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle" fill="white">groups/{groupId}</text>

  <text x="430" y="100" font-family="Arial" font-size="10" fill="#333">name: string</text>
  <text x="430" y="115" font-family="Arial" font-size="10" fill="#333">description: string</text>
  <text x="430" y="130" font-family="Arial" font-size="10" fill="#333">isPrivate: boolean</text>
  <text x="430" y="145" font-family="Arial" font-size="10" fill="#333">memberCount: number</text>

  <!-- Groups Subcollections -->
  <rect x="420" y="200" width="75" height="35" rx="5" fill="#E1BEE7" stroke="#9C27B0" stroke-width="1.5"/>
  <text x="457" y="222" font-family="Arial" font-size="9" text-anchor="middle" fill="#333">members</text>

  <rect x="505" y="200" width="75" height="35" rx="5" fill="#E1BEE7" stroke="#9C27B0" stroke-width="1.5"/>
  <text x="542" y="222" font-family="Arial" font-size="9" text-anchor="middle" fill="#333">messages</text>

  <line x1="457" y1="170" x2="457" y2="200" stroke="#9C27B0" stroke-width="1.5"/>
  <line x1="542" y1="170" x2="542" y2="200" stroke="#9C27B0" stroke-width="1.5"/>

  <!-- pushTokens Collection -->
  <rect x="230" y="300" width="160" height="100" rx="8" fill="#FFEBEE" stroke="#F44336" stroke-width="2"/>
  <rect x="230" y="300" width="160" height="30" rx="8" fill="#F44336"/>
  <text x="310" y="320" font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle" fill="white">pushTokens/{token}</text>

  <text x="240" y="350" font-family="Arial" font-size="10" fill="#333">userId: string</text>
  <text x="240" y="365" font-family="Arial" font-size="10" fill="#333">tokenType: expo|fcm</text>
  <text x="240" y="380" font-family="Arial" font-size="10" fill="#333">active: boolean</text>

  <!-- Reference arrow from notes to users -->
  <path d="M230 130 Q180 130 180 160 Q180 180 150 180" stroke="#F44336" stroke-width="1.5" fill="none" stroke-dasharray="5,3" marker-end="url(#arrow)"/>
  <text x="175" y="155" font-family="Arial" font-size="8" fill="#F44336">ref: authorId</text>

  <!-- Legend -->
  <rect x="420" y="300" width="160" height="90" rx="5" fill="#F5F5F5" stroke="#DDD"/>
  <text x="430" y="320" font-family="Arial" font-size="11" font-weight="bold" fill="#333">Legend</text>

  <rect x="430" y="330" width="20" height="12" fill="#2196F3"/>
  <text x="460" y="340" font-family="Arial" font-size="9" fill="#333">Collection</text>

  <rect x="430" y="350" width="20" height="12" fill="#4CAF50"/>
  <text x="460" y="360" font-family="Arial" font-size="9" fill="#333">Subcollection</text>

  <line x1="430" y1="375" x2="450" y2="375" stroke="#F44336" stroke-width="1.5" stroke-dasharray="5,3"/>
  <text x="460" y="378" font-family="Arial" font-size="9" fill="#333">Reference</text>

  <!-- Footer -->
  <text x="300" y="435" font-family="Arial" font-size="10" text-anchor="middle" fill="#999">Fig. 2: Firestore Database Schema</text>
</svg>
